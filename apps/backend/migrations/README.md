# Database Migrations

This directory contains database migration files generated by Drizzle Kit.

## Available Commands

### Setup Database (First Time)
Create database and run migrations automatically:
```bash
pnpm db:setup
```

### Generate New Migration
Generate a new migration based on schema changes:
```bash
pnpm db:generate
```

### Run Migrations
Apply pending migrations to the database:
```bash
pnpm db:migrate
```

### Push Schema (Development)
Push schema changes directly to the database without generating migrations (useful for development):
```bash
pnpm db:push
```

### Open Drizzle Studio
Launch the visual database browser:
```bash
pnpm db:studio
```

### Drop Migration
Remove the last migration:
```bash
pnpm db:drop
```

## Migration Files

- `*.sql` - SQL migration files
- `meta/_journal.json` - Migration history
- `meta/*_snapshot.json` - Schema snapshots

## Environment Variables

Set `DATABASE_URL` in your environment:
```bash
DATABASE_URL=postgresql://user:password@localhost:5432/database_name
```

## Workflow

1. Modify schema in `apps/backend/src/infrastructure/persistence/schema.ts`
2. Generate migration: `pnpm db:generate`
3. Review the generated SQL in `apps/backend/migrations/`
4. Apply migration: `pnpm db:migrate`

## Notes

- Always review generated migrations before applying them
- Keep migrations in version control
- Never modify applied migrations
- For production, use `pnpm db:migrate` (not `db:push`)

